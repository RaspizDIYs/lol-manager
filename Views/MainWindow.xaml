<ui:FluentWindow x:Class="LolManager.Views.MainWindow"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                 xmlns:vm="clr-namespace:LolManager.ViewModels"
                 xmlns:conv="clr-namespace:LolManager.Converters"
                 xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
                 xmlns:pages="clr-namespace:LolManager.Views.Pages"
                 mc:Ignorable="d"
                 Title="LeagueManager" Height="520" Width="1300"
                 MaxWidth="5000"
                 MaxHeight="5000"
                 MinWidth="920"
                 MinHeight="520"
                 ExtendsContentIntoTitleBar="True"
                 WindowBackdropType="None"
                 WindowCornerPreference="Round"
                 Icon="/icon.ico"
                 Closing="Window_Closing">
    <ui:FluentWindow.DataContext>
        <vm:MainViewModel />
    </ui:FluentWindow.DataContext>

    <ui:FluentWindow.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibility" />
        <conv:IndexToVisibilityConverter x:Key="IndexToVisibility" />
        <conv:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibility" />
        <conv:LogTypeConverter x:Key="LogTypeConverter" />
        
        <!-- Стиль для выбранной навигационной кнопки -->
        <Style x:Key="SelectedNavButtonStyle" TargetType="ui:Button" BasedOn="{StaticResource {x:Type ui:Button}}">
            <Setter Property="Background">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                        <GradientStop Color="#FF6366F1" Offset="0"/>
                        <GradientStop Color="#FF8B5CF6" Offset="1"/>
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#FF6366F1" Opacity="0.4" ShadowDepth="0" BlurRadius="12"/>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background">
                        <Setter.Value>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                <GradientStop Color="#FF7C3AED" Offset="0"/>
                                <GradientStop Color="#FFA855F7" Offset="1"/>
                            </LinearGradientBrush>
                        </Setter.Value>
                    </Setter>
                    <Setter Property="Effect">
                        <Setter.Value>
                            <DropShadowEffect Color="#FF7C3AED" Opacity="0.6" ShadowDepth="0" BlurRadius="16"/>
                        </Setter.Value>
                    </Setter>
                    <Setter Property="RenderTransform">
                        <Setter.Value>
                            <ScaleTransform ScaleX="1.02" ScaleY="1.02"/>
                        </Setter.Value>
                    </Setter>
                </Trigger>
            </Style.Triggers>
            <Style.Resources>
                <!-- Стиль для иконок в выбранной кнопке -->
                <Style TargetType="ui:SymbolIcon">
                    <Setter Property="Foreground" Value="White"/>
                    <Setter Property="Effect">
                        <Setter.Value>
                            <DropShadowEffect Color="Black" Opacity="0.3" ShadowDepth="1" BlurRadius="2"/>
                        </Setter.Value>
                    </Setter>
                </Style>
                <!-- Стиль для текста в выбранной кнопке -->
                <Style TargetType="TextBlock">
                    <Setter Property="Foreground" Value="White"/>
                    <Setter Property="FontWeight" Value="SemiBold"/>
                    <Setter Property="Effect">
                        <Setter.Value>
                            <DropShadowEffect Color="Black" Opacity="0.3" ShadowDepth="1" BlurRadius="2"/>
                        </Setter.Value>
                    </Setter>
                </Style>
            </Style.Resources>
        </Style>
        
        <!-- Стиль для обычных навигационных кнопок -->
        <Style x:Key="NavButtonStyle" TargetType="ui:Button" BasedOn="{StaticResource {x:Type ui:Button}}">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background">
                        <Setter.Value>
                            <SolidColorBrush Color="#FF2D3748" Opacity="0.6"/>
                        </Setter.Value>
                    </Setter>
                    <Setter Property="RenderTransform">
                        <Setter.Value>
                            <ScaleTransform ScaleX="1.01" ScaleY="1.01"/>
                        </Setter.Value>
                    </Setter>
                </Trigger>
            </Style.Triggers>
            <Style.Resources>
                <!-- Стиль для иконок в обычных кнопках -->
                <Style TargetType="ui:SymbolIcon">
                    <Setter Property="Foreground" Value="#FF9CA3AF"/>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsMouseOver, RelativeSource={RelativeSource AncestorType=ui:Button}}" Value="True">
                            <Setter Property="Foreground" Value="#FFCBD5E1"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
                <!-- Стиль для текста в обычных кнопках -->
                <Style TargetType="TextBlock">
                    <Setter Property="Foreground" Value="#FFE5E7EB"/>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsMouseOver, RelativeSource={RelativeSource AncestorType=ui:Button}}" Value="True">
                            <Setter Property="Foreground" Value="White"/>
                            <Setter Property="FontWeight" Value="Medium"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Style.Resources>
        </Style>
        
        <!-- Анимированные переходы для навигационных кнопок -->
        <Style x:Key="AnimatedNavButton" TargetType="ui:Button" BasedOn="{StaticResource NavButtonStyle}">
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Trigger.EnterActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                                               To="1.01" Duration="0:0:0.15">
                                    <DoubleAnimation.EasingFunction>
                                        <QuadraticEase EasingMode="EaseOut"/>
                                    </DoubleAnimation.EasingFunction>
                                </DoubleAnimation>
                                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)"
                                               To="1.01" Duration="0:0:0.15">
                                    <DoubleAnimation.EasingFunction>
                                        <QuadraticEase EasingMode="EaseOut"/>
                                    </DoubleAnimation.EasingFunction>
                                </DoubleAnimation>
                            </Storyboard>
                        </BeginStoryboard>
                    </Trigger.EnterActions>
                    <Trigger.ExitActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                                               To="1.0" Duration="0:0:0.15">
                                    <DoubleAnimation.EasingFunction>
                                        <QuadraticEase EasingMode="EaseOut"/>
                                    </DoubleAnimation.EasingFunction>
                                </DoubleAnimation>
                                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)"
                                               To="1.0" Duration="0:0:0.15">
                                    <DoubleAnimation.EasingFunction>
                                        <QuadraticEase EasingMode="EaseOut"/>
                                    </DoubleAnimation.EasingFunction>
                                </DoubleAnimation>
                            </Storyboard>
                        </BeginStoryboard>
                    </Trigger.ExitActions>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <Style x:Key="FadingCard" TargetType="ui:Card">
            <Setter Property="Opacity" Value="0"/>
            <Style.Triggers>
                <Trigger Property="Visibility" Value="Visible">
                    <Trigger.EnterActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:0.18"/>
                                <ThicknessAnimation Storyboard.TargetProperty="Margin" From="8,12,8,8" To="8" Duration="0:0:0.18"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </Trigger.EnterActions>
                </Trigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="FadeOnVisibleStack" TargetType="StackPanel">
            <Setter Property="Opacity" Value="0"/>
            <Style.Triggers>
                <Trigger Property="Visibility" Value="Visible">
                    <Trigger.EnterActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:0.15"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </Trigger.EnterActions>
                </Trigger>
            </Style.Triggers>
        </Style>
    </ui:FluentWindow.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition x:Name="MenuColumn" Width="Auto"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Современное боковое меню на всю высоту -->
        <Border Grid.Column="0" 
               x:Name="MenuBorder"
               Width="250"
               VerticalAlignment="Stretch">
            <Border.Background>
                <SolidColorBrush Color="#FF1A1A1A"/>
            </Border.Background>
            <Border.Resources>
                <!-- Анимация сворачивания -->
                <Storyboard x:Key="CollapseAnimation">
                    <DoubleAnimation Storyboard.TargetName="MenuBorder" 
                                   Storyboard.TargetProperty="Width"
                                   To="80" 
                                   Duration="0:0:0.3">
                        <DoubleAnimation.EasingFunction>
                            <QuadraticEase EasingMode="EaseInOut"/>
                        </DoubleAnimation.EasingFunction>
                    </DoubleAnimation>
                </Storyboard>
                
                <!-- Анимация разворачивания -->
                <Storyboard x:Key="ExpandAnimation">
                    <DoubleAnimation Storyboard.TargetName="MenuBorder" 
                                   Storyboard.TargetProperty="Width"
                                   To="250" 
                                   Duration="0:0:0.3">
                        <DoubleAnimation.EasingFunction>
                            <QuadraticEase EasingMode="EaseInOut"/>
                        </DoubleAnimation.EasingFunction>
                    </DoubleAnimation>
                </Storyboard>
            </Border.Resources>
            
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Заголовок приложения с кастомной иконкой -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="26,20,20,0">
                    <TextBlock x:Name="AppTitleShort" Text="LM" 
                               FontSize="20" FontWeight="SemiBold" 
                               Foreground="White" VerticalAlignment="Center"
                               Margin="0, 0, 10,0"/>
                </StackPanel>
                
                <!-- Кнопка сворачивания меню с анимацией -->
                <ui:Button x:Name="BurgerButton"
                          Grid.Row="1"
                          HorizontalAlignment="Left"
                          Width="40" Height="40"
                          Margin="20,16,0,0"
                          Appearance="Secondary"
                          Background="Transparent"
                          BorderThickness="0"
                          CornerRadius="8"
                          Click="BurgerButton_Click">
                    <ui:SymbolIcon x:Name="BurgerIcon" 
                                  Symbol="ChevronLeft24" 
                                  Foreground="#FF9CA3AF"
                                  RenderTransformOrigin="0.5,0.5">
                        <ui:SymbolIcon.RenderTransform>
                            <RotateTransform x:Name="BurgerIconRotate" Angle="0"/>
                        </ui:SymbolIcon.RenderTransform>
                    </ui:SymbolIcon>
                </ui:Button>
                
                <!-- Навигационные кнопки -->
                <StackPanel Grid.Row="2" Margin="15,32,15,20">
                    <ui:Button x:Name="AccountsButton"
                              HorizontalAlignment="Stretch"
                              HorizontalContentAlignment="Left"
                              Height="52"
                              Margin="0,0,0,8"
                              Appearance="Secondary"
                              Background="Transparent"
                              BorderThickness="0"
                              CornerRadius="12"
                              Tag="0"
                              Style="{StaticResource AnimatedNavButton}"
                              Click="NavButton_Click">
                        <ui:Button.RenderTransform>
                            <ScaleTransform ScaleX="1" ScaleY="1"/>
                        </ui:Button.RenderTransform>
                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon Symbol="Person32" Margin="3,0,14,0" FontSize="20" Foreground="#FF9CA3AF"/>
                            <TextBlock x:Name="AccountsText" Text="Аккаунты" VerticalAlignment="Center" 
                                      FontSize="14" FontWeight="Medium" Foreground="#FFE5E7EB"/>
                        </StackPanel>
                    </ui:Button>
                    
                    <ui:Button x:Name="SettingsButton"
                              HorizontalAlignment="Stretch"
                              HorizontalContentAlignment="Left"
                              Height="52"
                              Margin="0,0,0,8"
                              Appearance="Secondary"
                              Background="Transparent"
                              BorderThickness="0"
                              CornerRadius="12"
                              Tag="1"
                              Style="{StaticResource AnimatedNavButton}"
                              Click="NavButton_Click">
                        <ui:Button.RenderTransform>
                            <ScaleTransform ScaleX="1" ScaleY="1"/>
                        </ui:Button.RenderTransform>
                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon Symbol="Settings32" Margin="3,0,14,0" FontSize="20" Foreground="#FF9CA3AF"/>
                            <TextBlock x:Name="SettingsText" Text="Настройки" VerticalAlignment="Center" 
                                      FontSize="14" FontWeight="Medium" Foreground="#FFE5E7EB"/>
                        </StackPanel>
                    </ui:Button>
                    
                    <ui:Button x:Name="LogsButton"
                              HorizontalAlignment="Stretch"
                              HorizontalContentAlignment="Left"
                              Height="52"
                              Margin="0,0,0,8"
                              Appearance="Secondary"
                              Background="Transparent"
                              BorderThickness="0"
                              CornerRadius="12"
                              Tag="2"
                              Style="{StaticResource AnimatedNavButton}"
                              Click="NavButton_Click">
                        <ui:Button.RenderTransform>
                            <ScaleTransform ScaleX="1" ScaleY="1"/>
                        </ui:Button.RenderTransform>
                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon Symbol="DocumentText24" Margin="3,0,14,0" FontSize="20" Foreground="#FF9CA3AF"/>
                            <TextBlock x:Name="LogsText" Text="Логи" VerticalAlignment="Center" 
                                      FontSize="14" FontWeight="Medium" Foreground="#FFE5E7EB"/>
                        </StackPanel>
                    </ui:Button>
                    
                    <ui:Button x:Name="InformationButton"
                              HorizontalAlignment="Stretch"
                              HorizontalContentAlignment="Left"
                              Height="52"
                              Margin="0,0,0,8"
                              Appearance="Secondary"
                              Background="Transparent"
                              BorderThickness="0"
                              CornerRadius="12"
                              Tag="3"
                              Style="{StaticResource AnimatedNavButton}"
                              Click="NavButton_Click">
                        <ui:Button.RenderTransform>
                            <ScaleTransform ScaleX="1" ScaleY="1"/>
                        </ui:Button.RenderTransform>
                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon Symbol="Info24" Margin="3,0,14,0" FontSize="20" Foreground="#FF9CA3AF"/>
                            <TextBlock x:Name="InformationText" Text="Информация" VerticalAlignment="Center" 
                                      FontSize="14" FontWeight="Medium" Foreground="#FFE5E7EB"/>
                        </StackPanel>
                    </ui:Button>
                    
                    <ui:Button x:Name="AutomationButton"
                              HorizontalAlignment="Stretch"
                              HorizontalContentAlignment="Left"
                              Height="52"
                              Margin="0,0,0,8"
                              Appearance="Secondary"
                              Background="Transparent"
                              BorderThickness="0"
                              CornerRadius="12"
                              Tag="4"
                              Style="{StaticResource AnimatedNavButton}"
                              Click="NavButton_Click">
                        <ui:Button.RenderTransform>
                            <ScaleTransform ScaleX="1" ScaleY="1"/>
                        </ui:Button.RenderTransform>
                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon Symbol="BotSparkle24" Margin="3,0,14,0" FontSize="20" Foreground="#FF9CA3AF"/>
                            <TextBlock x:Name="AutomationText" Text="Автоматизация" VerticalAlignment="Center" 
                                      FontSize="14" FontWeight="Medium" Foreground="#FFE5E7EB"/>
                        </StackPanel>
                    </ui:Button>
                    
                    <ui:Button x:Name="SpyButton"
                              HorizontalAlignment="Stretch"
                              HorizontalContentAlignment="Left"
                              Height="52"
                              Margin="0,0,0,8"
                              Appearance="Secondary"
                              Background="Transparent"
                              BorderThickness="0"
                              CornerRadius="12"
                              Tag="5"
                              Style="{StaticResource AnimatedNavButton}"
                              Click="NavButton_Click"
                              Visibility="{Binding RevealSettings.IsEnabled, Converter={StaticResource BoolToVisibility}}">
                        <ui:Button.RenderTransform>
                            <ScaleTransform ScaleX="1" ScaleY="1"/>
                        </ui:Button.RenderTransform>
                        <StackPanel Orientation="Horizontal">
                            <ui:SymbolIcon Symbol="Eye24" Margin="3,0,14,0" FontSize="20" Foreground="#FF9CA3AF"/>
                            <TextBlock x:Name="SpyText" Text="Шпион" VerticalAlignment="Center" 
                                      FontSize="14" FontWeight="Medium" Foreground="#FFE5E7EB"/>
                        </StackPanel>
                    </ui:Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Основной контент с TitleBar -->
        <Grid Grid.Column="1" Background="#FF0F0F0F">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- TitleBar -->
            <ui:TitleBar 
                Grid.Row="0"
                Title="" 
                ForceShutdown="False"
                ShowMinimize="True"
                ShowMaximize="True"
                ShowClose="True"/>

            <!-- Контент страниц -->
            <Grid Grid.Row="1" Margin="24,12,24,24">
                <!-- Accounts Page -->
                <pages:AccountsPage x:Name="AccountsPage"
                                   Visibility="{Binding SelectedTabIndex, ConverterParameter=0, Converter={StaticResource IndexToVisibility}}" 
                                   DataContext="{Binding}"/>

                <!-- Settings Page -->
                <pages:SettingsPage x:Name="SettingsPage"
                                   Visibility="{Binding SelectedTabIndex, ConverterParameter=1, Converter={StaticResource IndexToVisibility}}" 
                                   DataContext="{Binding}"/>

                <!-- Logs Page -->
                <pages:LogsPage x:Name="LogsPage"
                               Visibility="{Binding SelectedTabIndex, ConverterParameter=2, Converter={StaticResource IndexToVisibility}}" 
                               DataContext="{Binding}"/>
                
                <!-- Information Page -->
                <pages:InformationPage x:Name="InformationPage"
                                      Visibility="{Binding SelectedTabIndex, ConverterParameter=3, Converter={StaticResource IndexToVisibility}}" 
                                      DataContext="{Binding}"/>

                <!-- Automation Page -->
                <pages:AutomationPage x:Name="AutomationPage"
                                     Visibility="{Binding SelectedTabIndex, ConverterParameter=4, Converter={StaticResource IndexToVisibility}}"
                                     DataContext="{Binding}"/>

                <!-- Spy Page -->
                <pages:SpyPage x:Name="SpyPage"
                              Visibility="{Binding SelectedTabIndex, ConverterParameter=5, Converter={StaticResource IndexToVisibility}}"
                              DataContext="{Binding}"/>

                <!-- Add Account Page -->
                <pages:AddAccountPage x:Name="AddAccountPage"
                                     Visibility="{Binding SelectedTabIndex, ConverterParameter=6, Converter={StaticResource IndexToVisibility}}" 
                                     DataContext="{Binding}"/>
            </Grid>
        </Grid>
        
        <!-- Контейнер для уведомлений поверх всего контента -->
        <Border x:Name="NotificationContainer" 
                Grid.Column="1"
                Background="Transparent" 
                IsHitTestVisible="False"
                VerticalAlignment="Top"
                HorizontalAlignment="Center"
                Margin="0,10,0,0"
                Panel.ZIndex="1000"/>
        
        <!-- Элемент для привязки popup меню закрытия -->
        <Border x:Name="CloseButtonAnchor" 
                Grid.Column="1"
                Width="1"
                Height="1"
                HorizontalAlignment="Right"
                VerticalAlignment="Top"
                Margin="0,6,46,0"
                Background="Transparent"/>
        
        <!-- Popup для выбора действия при закрытии -->
        <Popup x:Name="CloseActionPopup" 
               StaysOpen="False"
               Placement="Bottom"
               PlacementTarget="{x:Reference CloseButtonAnchor}"
               HorizontalOffset="-150"
               VerticalOffset="8"
               AllowsTransparency="True">
            <Border Background="{DynamicResource ControlFillColorDefaultBrush}"
                    BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="4">
                <Border.Effect>
                    <DropShadowEffect Color="Black" Opacity="0.3" ShadowDepth="0" BlurRadius="12"/>
                </Border.Effect>
                <StackPanel>
                    <ui:Button x:Name="MinimizeToTrayButton"
                              Content="Свернуть в трей"
                              Appearance="Secondary"
                              HorizontalAlignment="Stretch"
                              HorizontalContentAlignment="Left"
                              Height="36"
                              Margin="2"
                              Click="MinimizeToTrayButton_Click">
                        <ui:Button.Icon>
                            <ui:SymbolIcon Symbol="ChevronDown24"/>
                        </ui:Button.Icon>
                    </ui:Button>
                    <ui:Button x:Name="ExitAppButton"
                              Content="Закрыть полностью"
                              Appearance="Secondary"
                              HorizontalAlignment="Stretch"
                              HorizontalContentAlignment="Left"
                              Height="36"
                              Margin="2"
                              Click="ExitAppButton_Click">
                        <ui:Button.Icon>
                            <ui:SymbolIcon Symbol="Dismiss24"/>
                        </ui:Button.Icon>
                    </ui:Button>
                </StackPanel>
            </Border>
        </Popup>
    </Grid>
</ui:FluentWindow>