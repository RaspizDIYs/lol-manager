<UserControl x:Class="LolManager.Views.Pages.SettingsPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
             xmlns:converters="clr-namespace:LolManager.Converters"
             mc:Ignorable="d">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <StackPanel Grid.Row="0" Margin="20,20,20,0">
            <TextBlock Text="Настройки" FontSize="24" FontWeight="Bold" Margin="0,0,0,6"/>
            <TextBlock Text="Настройка приложения и интеграций" 
                       FontSize="12" 
                       Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                       Margin="0,0,0,16"/>
        </StackPanel>
        
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="20,0,20,20">
                
                <!-- Настройки интерфейса -->
                <ui:Card Padding="16" Margin="0,0,0,20">
                    <StackPanel>
                        <TextBlock Text="Интерфейс" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,15"/>
                        
                        <CheckBox x:Name="HideLoginCheckBox" 
                                  Content="Скрыть логин" 
                                  IsChecked="{Binding HideLogin}"/>

                        <TextBlock Text="Действие при закрытии окна"
                                   Margin="0,16,0,6"
                                   FontWeight="SemiBold"/>
                        <ComboBox ItemsSource="{Binding CloseBehaviorOptions}"
                                  SelectedValuePath="Value"
                                  DisplayMemberPath="Key"
                                  SelectedValue="{Binding CloseBehavior}"
                                  MinWidth="220"
                                  HorizontalAlignment="Left"/>
                        <TextBlock Text="По умолчанию — спрашивать каждый раз"
                                   FontSize="11"
                                   Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                   Margin="0,4,0,0"/>
                    </StackPanel>
                </ui:Card>
                
                <!-- Настройки автопринятия -->
                <ui:Card Padding="16" Margin="0,0,0,20">
                    <StackPanel>
                        <TextBlock Text="Автопринятие матчей" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,10"/>
                        
                        <TextBlock Margin="0,0,0,12" TextWrapping="Wrap" FontSize="12" Opacity="0.7">
                            <Bold>Рекомендуется: Auto</Bold> - WebSocket с автопереключением на Polling при сбоях
                        </TextBlock>
                        
                        <WrapPanel>
                            <RadioButton GroupName="AutoAcceptMethod" Content="Auto" Margin="0,0,15,0"
                                         IsChecked="{Binding AutoAcceptMethod, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Auto}" />
                            <RadioButton GroupName="AutoAcceptMethod" Content="WebSocket" Margin="0,0,15,0"
                                         IsChecked="{Binding AutoAcceptMethod, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=WebSocket}" />
                            <RadioButton GroupName="AutoAcceptMethod" Content="Polling" Margin="0,0,15,0"
                                         IsChecked="{Binding AutoAcceptMethod, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Polling}" />
                            <RadioButton GroupName="AutoAcceptMethod" Content="UIA" Margin="0,0,0,0"
                                         IsChecked="{Binding AutoAcceptMethod, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=UIA}" />
                        </WrapPanel>
                        
                        <TextBlock Margin="0,8,0,0" TextWrapping="Wrap" FontSize="11" Opacity="0.6">
                            Auto - мгновенная реакция, Polling - стабильный, UIA - если другие не работают
                        </TextBlock>
                    </StackPanel>
                </ui:Card>
                
                <!-- Настройки Reveal -->
                <ui:Card Padding="16" Margin="0,0,0,20">
                    <StackPanel>
                        <TextBlock Text="Reveal (шпион)" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,10"/>
                        <TextBlock Margin="0,0,0,15" TextWrapping="Wrap" Opacity="0.7">
                            Показывает информацию об игроках в вашей команде во время выбора чемпионов. Требует ключ Riot API.
                        </TextBlock>
                        
                        <CheckBox x:Name="RevealEnabledCheckBox" 
                                  Content="Включить Reveal" 
                                  IsChecked="{Binding RevealSettings.IsEnabled}"/>
                    </StackPanel>
                </ui:Card>
                
                <!-- Настройки обновлений -->
                <ui:Card Padding="16" Margin="0,0,0,20">
                    <StackPanel>
                        <TextBlock Text="Обновления" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,15"/>
                        
                        <CheckBox x:Name="AutoUpdateCheckBox" 
                                  Content="Включить автоматические обновления" 
                                  IsChecked="{Binding UpdateSettings.AutoUpdateEnabled}"
                                  Margin="0,0,0,15"/>
                        
                        <Grid Margin="0,0,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Способ обновления:" VerticalAlignment="Center" Margin="0,0,15,0"/>
                            <ComboBox Grid.Column="1"
                                      MinWidth="150"
                                      HorizontalAlignment="Left"
                                      SelectedItem="{Binding UpdateSettings.UpdateMode}"
                                      ItemsSource="{Binding UpdateModes}"/>
                        </Grid>

                        <Grid Margin="0,0,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Канал обновлений:" VerticalAlignment="Center" Margin="0,0,15,0"/>
                            <ComboBox Grid.Column="1"
                                      MinWidth="150"
                                      HorizontalAlignment="Left"
                                      SelectedItem="{Binding UpdateSettings.UpdateChannel}"
                                      ItemsSource="{Binding UpdateChannels}"/>
                        </Grid>
                        
                        <Grid Margin="0,0,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Последняя проверка:" VerticalAlignment="Center" Margin="0,0,15,0"/>
                            <TextBlock Grid.Column="1"
                                       Text="{Binding UpdateSettings.LastCheckTime, StringFormat='dd.MM.yyyy HH:mm'}" 
                                       VerticalAlignment="Center" 
                                       Foreground="Gray"/>
                        </Grid>
                        
                        <ui:Button Content="Проверить обновления сейчас" 
                                   Command="{Binding CheckUpdatesNowCommand}"
                                   Appearance="Primary"
                                   HorizontalAlignment="Left"
                                   Margin="0,5,0,0"/>
                    </StackPanel>
                </ui:Card>

                <!-- League Client -->
                <ui:Card Padding="16">
                    <StackPanel>
                        <TextBlock Text="League Client" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,10"/>
                        
                        <CheckBox Content="Использовать вручную указанный путь"
                                  IsChecked="{Binding LeagueSettings.PreferManualPath}"
                                  Margin="0,0,0,8"/>
                        
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <TextBox Grid.Column="0"
                                     Text="{Binding LeagueSettings.InstallDirectory, UpdateSourceTrigger=PropertyChanged}"
                                     Margin="0,0,8,0"/>
                            <ui:Button Grid.Column="1"
                                       Content="Обзор..." 
                                       Margin="0,0,8,0" 
                                       Command="{Binding BrowseLeagueInstallCommand}"/>
                            <ui:Button Grid.Column="2"
                                       Content="Проверить" 
                                       Command="{Binding ValidateLeaguePathCommand}"/>
                        </Grid>
                        
                        <TextBlock Foreground="Gray" FontSize="12" Margin="0,6,0,0">
                            <Run Text="Последний авто‑детект: "/>
                            <Run Text="{Binding LeagueSettings.LastDetectedInstallDirectory}"/>
                        </TextBlock>
                    </StackPanel>
                </ui:Card>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>

