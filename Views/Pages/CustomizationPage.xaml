<UserControl x:Class="LolManager.Views.Pages.CustomizationPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
             xmlns:converters="clr-namespace:LolManager.Converters"
             x:Name="CustomizationPageRoot">
    
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibility"/>
        <converters:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibility"/>
        <converters:ChampionImageConverter x:Key="ChampionImageConverter"/>
        <converters:ChampionSplashartConverter x:Key="ChampionSplashartConverter"/>
        <converters:ChallengeIconConverter x:Key="ChallengeIconConverter"/>
        <converters:MultiObjectEqualityConverter x:Key="MultiObjectEqualityConverter"/>
        <converters:ImageUrlConverter x:Key="ImageUrlConverter"/>
        
        <DataTemplate x:Key="ChampionTemplate">
            <StackPanel Orientation="Horizontal">
                <Border Width="28" 
                        Height="28" 
                        CornerRadius="14"
                        Margin="0,0,6,0"
                        VerticalAlignment="Center"
                        ClipToBounds="True">
                    <Image Source="{Binding Converter={StaticResource ChampionImageConverter}}" 
                           Stretch="UniformToFill"
                           RenderOptions.BitmapScalingMode="LowQuality"
                           RenderOptions.CachingHint="Cache"/>
                </Border>
                <TextBlock Text="{Binding}" 
                           VerticalAlignment="Center"
                           FontSize="12"/>
            </StackPanel>
        </DataTemplate>
        
        <DataTemplate x:Key="BackgroundChampionTemplate">
            <Border CornerRadius="8"
                    Margin="4"
                    Width="200"
                    Height="120"
                    ClipToBounds="True"
                    Cursor="Hand"
                    MouseLeftButtonDown="BackgroundChampion_MouseLeftButtonDown">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="Background" Value="{DynamicResource CardBackgroundFillColorDefaultBrush}"/>
                        <Setter Property="BorderBrush" Value="{DynamicResource ControlStrokeColorDefaultBrush}"/>
                        <Setter Property="BorderThickness" Value="1"/>
                        <Style.Triggers>
                            <DataTrigger Value="True">
                                <DataTrigger.Binding>
                                    <MultiBinding Converter="{StaticResource MultiObjectEqualityConverter}">
                                        <Binding ElementName="CustomizationPageRoot" Path="ViewModel.SelectedChampionForBackground"/>
                                        <Binding Path="."/>
                                    </MultiBinding>
                                </DataTrigger.Binding>
                                <Setter Property="BorderBrush" Value="#FF6366F1"/>
                                <Setter Property="BorderThickness" Value="3"/>
                            </DataTrigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="BorderBrush" Value="#FF6366F1"/>
                                <Setter Property="BorderThickness" Value="2"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
                <Grid>
                    <Image Source="{Binding Converter={StaticResource ChampionSplashartConverter}, ConverterParameter=256}"
                           RenderOptions.BitmapScalingMode="LowQuality"
                           RenderOptions.CachingHint="Cache"
                           Stretch="UniformToFill"
                           Opacity="0.7"/>
                    <Border Background="#80000000" VerticalAlignment="Bottom">
                        <TextBlock Text="{Binding}"
                                   Foreground="White"
                                   FontSize="12"
                                   FontWeight="SemiBold"
                                   Margin="8,4"
                                   TextTrimming="CharacterEllipsis"/>
                    </Border>
                </Grid>
            </Border>
        </DataTemplate>
        
        <DataTemplate x:Key="BackgroundSkinTemplate">
            <Border CornerRadius="8"
                    Margin="4"
                    Width="200"
                    Height="120"
                    ClipToBounds="True"
                    Cursor="Hand"
                    MouseLeftButtonDown="BackgroundSkin_MouseLeftButtonDown">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="Background" Value="{DynamicResource CardBackgroundFillColorDefaultBrush}"/>
                        <Setter Property="BorderBrush" Value="{DynamicResource ControlStrokeColorDefaultBrush}"/>
                        <Setter Property="BorderThickness" Value="1"/>
                        <Style.Triggers>
                            <DataTrigger Value="True">
                                <DataTrigger.Binding>
                                    <MultiBinding Converter="{StaticResource MultiObjectEqualityConverter}">
                                        <Binding ElementName="CustomizationPageRoot" Path="ViewModel.SelectedSkinForBackground"/>
                                        <Binding Path="."/>
                                    </MultiBinding>
                                </DataTrigger.Binding>
                                <Setter Property="BorderBrush" Value="#FF6366F1"/>
                                <Setter Property="BorderThickness" Value="3"/>
                            </DataTrigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="BorderBrush" Value="#FF6366F1"/>
                                <Setter Property="BorderThickness" Value="2"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
                <Grid>
                    <Image Stretch="UniformToFill"
                           Opacity="0.7"
                           RenderOptions.BitmapScalingMode="HighQuality"
                           ImageFailed="Image_ImageFailed"
                           Source="{Binding SplashUrl, Converter={StaticResource ImageUrlConverter}, ConverterParameter=256}"/>
                    <Border Background="#80000000" VerticalAlignment="Bottom">
                        <StackPanel Margin="8,4">
                            <TextBlock Text="{Binding ChampionName}"
                                       Foreground="White"
                                       FontSize="11"
                                       FontWeight="SemiBold"
                                       TextTrimming="CharacterEllipsis"/>
                            <TextBlock Text="{Binding Name}"
                                       Foreground="#CCFFFFFF"
                                       FontSize="10"
                                       TextTrimming="CharacterEllipsis"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>
        </DataTemplate>
        
        <DataTemplate x:Key="ChallengeTemplate">
            <Border CornerRadius="8"
                    Margin="4"
                    Width="100"
                    Height="100"
                    ClipToBounds="True"
                    Cursor="Hand"
                    MouseLeftButtonDown="Challenge_MouseLeftButtonDown">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="Background" Value="{DynamicResource CardBackgroundFillColorDefaultBrush}"/>
                        <Setter Property="BorderBrush" Value="{DynamicResource ControlStrokeColorDefaultBrush}"/>
                        <Setter Property="BorderThickness" Value="1"/>
                        <Style.Triggers>
                            <MultiDataTrigger>
                                <MultiDataTrigger.Conditions>
                                    <Condition Binding="{Binding ElementName=CustomizationPageRoot, Path=ViewModel.SelectedChallenge1}" Value="{Binding}"/>
                                </MultiDataTrigger.Conditions>
                                <Setter Property="BorderBrush" Value="#FF6366F1"/>
                                <Setter Property="BorderThickness" Value="3"/>
                            </MultiDataTrigger>
                            <MultiDataTrigger>
                                <MultiDataTrigger.Conditions>
                                    <Condition Binding="{Binding ElementName=CustomizationPageRoot, Path=ViewModel.SelectedChallenge2}" Value="{Binding}"/>
                                </MultiDataTrigger.Conditions>
                                <Setter Property="BorderBrush" Value="#FF6366F1"/>
                                <Setter Property="BorderThickness" Value="3"/>
                            </MultiDataTrigger>
                            <MultiDataTrigger>
                                <MultiDataTrigger.Conditions>
                                    <Condition Binding="{Binding ElementName=CustomizationPageRoot, Path=ViewModel.SelectedChallenge3}" Value="{Binding}"/>
                                </MultiDataTrigger.Conditions>
                                <Setter Property="BorderBrush" Value="#FF6366F1"/>
                                <Setter Property="BorderThickness" Value="3"/>
                            </MultiDataTrigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="BorderBrush" Value="#FF6366F1"/>
                                <Setter Property="BorderThickness" Value="2"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
                <Image Source="{Binding Converter={StaticResource ChallengeIconConverter}, ConverterParameter=100}"
                       RenderOptions.BitmapScalingMode="LowQuality"
                       RenderOptions.CachingHint="Cache"
                       Stretch="UniformToFill"/>
            </Border>
        </DataTemplate>
        
        <DataTemplate x:Key="SelectedChallengeTemplate">
            <Border CornerRadius="8"
                    Margin="4"
                    Width="80"
                    Height="80"
                    ClipToBounds="True"
                    Cursor="Hand"
                    MouseLeftButtonDown="SelectedChallenge_MouseLeftButtonDown">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="Background" Value="{DynamicResource CardBackgroundFillColorDefaultBrush}"/>
                        <Setter Property="BorderBrush" Value="#FF6366F1"/>
                        <Setter Property="BorderThickness" Value="2"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="BorderBrush" Value="#FFFF6B6B"/>
                                <Setter Property="BorderThickness" Value="3"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
                <Grid>
                    <Image Source="{Binding Converter={StaticResource ChallengeIconConverter}, ConverterParameter=80}"
                           Stretch="UniformToFill"/>
                    <Border Background="#80000000" 
                            VerticalAlignment="Top" 
                            HorizontalAlignment="Right"
                            CornerRadius="0,8,0,8"
                            Padding="4,2">
                        <TextBlock Text="âœ•"
                                   Foreground="White"
                                   FontSize="12"
                                   FontWeight="Bold"/>
                    </Border>
                </Grid>
            </Border>
        </DataTemplate>
    </UserControl.Resources>
    
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="16">
            <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº -->
            <TextBlock Text="ÐšÐ°ÑÑ‚Ð¾Ð¼Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»Ñ" 
                       FontSize="24" 
                       FontWeight="Bold" 
                       Margin="0,0,0,8"/>
            <TextBlock Text="ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ Ð²Ð½ÐµÑˆÐ½Ð¸Ð¹ Ð²Ð¸Ð´ Ð²Ð°ÑˆÐµÐ³Ð¾ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»Ñ Ð² ÐºÐ»Ð¸ÐµÐ½Ñ‚Ðµ League of Legends"
                       FontSize="12"
                       Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                       TextWrapping="Wrap"
                       Margin="0,0,0,20"/>
            
            <!-- ÐŸÑ€ÐµÐ´ÑƒÐ¿Ñ€ÐµÐ¶Ð´ÐµÐ½Ð¸Ðµ -->
            <Border Background="#FFFF6B6B" CornerRadius="8" Padding="12" Margin="0,0,0,24">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                        <ui:SymbolIcon Symbol="Info24" Foreground="White" FontSize="18" Margin="0,0,8,0"/>
                        <TextBlock Text="ÐŸÐ Ð•Ð”Ð£ÐŸÐ Ð•Ð–Ð”Ð•ÐÐ˜Ð•" FontSize="13" FontWeight="Bold" Foreground="White"/>
                    </StackPanel>
                    <TextBlock Text="Ð­Ñ‚Ð° Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ÑÑ Ð² ÑÐµÑ€Ð¾Ð¹ Ð·Ð¾Ð½Ðµ Riot Games. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¿Ð¾Ð²Ð»ÐµÑ‡ÑŒ Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²ÐºÑƒ Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚Ð°. Ð Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº Ð½Ðµ Ð½ÐµÑÑ‘Ñ‚ Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸." 
                               TextWrapping="Wrap" Foreground="White" FontSize="12"/>
                </StackPanel>
            </Border>
            
            <!-- Ð¡Ñ‚Ð°Ñ‚ÑƒÑ -->
            <ui:Card Margin="0,0,0,16" Padding="20">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel Grid.Row="0" Grid.ColumnSpan="2" Margin="0,0,0,12">
                        <TextBlock Text="Ð¡Ñ‚Ð°Ñ‚ÑƒÑ" 
                                   FontSize="16" 
                                   FontWeight="SemiBold" 
                                   Margin="0,0,0,4"/>
                        <TextBlock Text="ÐžÐ±Ñ…Ð¾Ð´ Ð»Ð¸Ð¼Ð¸Ñ‚Ð° ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð² Ð² ÑÑ‚Ð°Ñ‚ÑƒÑÐµ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»Ñ" 
                                   FontSize="11"
                                   Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                   TextWrapping="Wrap"/>
                    </StackPanel>
                    
                    <ui:TextBox Grid.Row="1" Grid.Column="0"
                                Text="{Binding ElementName=CustomizationPageRoot, Path=ViewModel.CustomStatus, Mode=TwoWay}"
                                PlaceholderText="Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ÑÑ‚Ð°Ñ‚ÑƒÑ..."
                                Margin="0,0,8,0"
                                AcceptsReturn="True"
                                TextWrapping="Wrap"
                                VerticalContentAlignment="Top"
                                FontFamily="Cascadia Code"
                                MinHeight="140"
                                VerticalScrollBarVisibility="Auto" />
                    <ui:Button Grid.Row="1" Grid.Column="1"
                               Content="ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ"
                               Command="{Binding ElementName=CustomizationPageRoot, Path=ViewModel.SetStatusCommand}"
                               IsEnabled="{Binding ElementName=CustomizationPageRoot, Path=ViewModel.IsLoading, Converter={StaticResource InverseBoolToVisibility}}"
                               Appearance="Primary"
                               MinWidth="100"/>
                </Grid>
            </ui:Card>
            
            <!-- Ð‘ÐµÐºÐ³Ñ€Ð°ÑƒÐ½Ð´ -->
            <ui:Card Margin="0,0,0,16" Padding="20">
                <StackPanel>
                    <StackPanel Margin="0,0,0,12">
                        <TextBlock Text="Ð¤Ð¾Ð½ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»Ñ" 
                                   FontSize="16" 
                                   FontWeight="SemiBold" 
                                   Margin="0,0,0,4"/>
                        <TextBlock Text="Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚Ðµ Ñ„Ð¾Ð½ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»Ñ Ð½Ð° splashart Ð»ÑŽÐ±Ð¾Ð³Ð¾ Ñ‡ÐµÐ¼Ð¿Ð¸Ð¾Ð½Ð°" 
                                   FontSize="11"
                                   Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                   TextWrapping="Wrap"/>
                    </StackPanel>
                    
                    <ui:TextBox Text="{Binding ElementName=CustomizationPageRoot, Path=ViewModel.BackgroundSearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                PlaceholderText="ðŸ” ÐŸÐ¾Ð¸ÑÐº Ñ‡ÐµÐ¼Ð¿Ð¸Ð¾Ð½Ð°..."
                                Margin="0,0,0,12"/>
                    
                    <ScrollViewer x:Name="SkinsScrollViewer"
                                  MaxHeight="400"
                                  VerticalScrollBarVisibility="Auto"
                                  Margin="0,0,0,12"
                                  ScrollViewer.CanContentScroll="False"
                                  ScrollChanged="SkinsScrollViewer_ScrollChanged">
                        <ItemsControl ItemsSource="{Binding ElementName=CustomizationPageRoot, Path=ViewModel.FilteredSkins}"
                                      ItemTemplate="{StaticResource BackgroundSkinTemplate}"
                                      VirtualizingPanel.IsVirtualizing="True"
                                      VirtualizingPanel.VirtualizationMode="Recycling">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                        </ItemsControl>
                    </ScrollViewer>
                    
                    <ui:Button Content="ÐŸÐ¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ ÐµÑ‰Ñ‘"
                               Command="{Binding ElementName=CustomizationPageRoot, Path=ViewModel.LoadMoreSkinsCommand}"
                               Visibility="{Binding ElementName=CustomizationPageRoot, Path=ViewModel.HasMoreSkins, Converter={StaticResource BoolToVisibility}}"
                               Appearance="Secondary"
                               HorizontalAlignment="Center"
                               MinWidth="140"
                               Margin="0,0,0,12"/>
                    
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <ComboBox Grid.Column="0"
                                  ItemsSource="{Binding ElementName=CustomizationPageRoot, Path=ViewModel.FilteredChampions}"
                                  SelectedItem="{Binding ElementName=CustomizationPageRoot, Path=ViewModel.SelectedChampionForBackground, Mode=TwoWay}"
                                  ItemTemplate="{StaticResource ChampionTemplate}"
                                  MaxDropDownHeight="350"
                                  Margin="0,0,8,0">
                            <ComboBox.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <VirtualizingStackPanel/>
                                </ItemsPanelTemplate>
                            </ComboBox.ItemsPanel>
                        </ComboBox>
                        
                        <ComboBox Grid.Column="1"
                                  ItemsSource="{Binding ElementName=CustomizationPageRoot, Path=ViewModel.AvailableSkins}"
                                  SelectedItem="{Binding ElementName=CustomizationPageRoot, Path=ViewModel.SelectedSkinForBackground, Mode=TwoWay}"
                                  Margin="0,0,8,0"
                                  MaxDropDownHeight="350"
                                  IsEnabled="{Binding ElementName=CustomizationPageRoot, Path=ViewModel.SelectedChampionForBackground, Converter={StaticResource NotNullConverter}}">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Name}"/>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                        
                        <ui:Button Grid.Column="2"
                                   Content="ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ"
                                   Command="{Binding ElementName=CustomizationPageRoot, Path=ViewModel.SetBackgroundCommand}"
                                   IsEnabled="{Binding ElementName=CustomizationPageRoot, Path=ViewModel.IsLoading, Converter={StaticResource InverseBoolToVisibility}}"
                                   Appearance="Primary"
                                   MinWidth="100"/>
                    </Grid>
                </StackPanel>
            </ui:Card>
            
            <!-- Ð§ÐµÐ»ÐµÐ½Ð´Ð¶Ð¸ -->
            <ui:Card Margin="0,0,0,16" Padding="20">
                <StackPanel>
                    <StackPanel Margin="0,0,0,12">
                        <TextBlock Text="Ð§ÐµÐ»ÐµÐ½Ð´Ð¶Ð¸" 
                                   FontSize="16" 
                                   FontWeight="SemiBold" 
                                   Margin="0,0,0,4"/>
                        <TextBlock Text="Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð´Ð¾ 3 Ñ‡ÐµÐ»ÐµÐ½Ð´Ð¶ÐµÐ¹ Ð´Ð»Ñ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ Ð² Ð¿Ñ€Ð¾Ñ„Ð¸Ð»Ðµ. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð½Ð° Ð¸ÐºÐ¾Ð½ÐºÑƒ Ñ‡ÐµÐ»ÐµÐ½Ð´Ð¶Ð° Ð´Ð»Ñ Ð²Ñ‹Ð±Ð¾Ñ€Ð°, Ð½Ð° Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ð¹ Ñ‡ÐµÐ»ÐµÐ½Ð´Ð¶ - Ð´Ð»Ñ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ." 
                                   FontSize="11"
                                   Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                   TextWrapping="Wrap"/>
                    </StackPanel>
                    
                    <!-- Ð’Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ðµ Ñ‡ÐµÐ»ÐµÐ½Ð´Ð¶Ð¸ -->
                    <StackPanel Margin="0,0,0,12" Visibility="{Binding ElementName=CustomizationPageRoot, Path=ViewModel.HasSelectedChallenges, Converter={StaticResource BoolToVisibility}}">
                        <TextBlock Text="Ð’Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ðµ Ñ‡ÐµÐ»ÐµÐ½Ð´Ð¶Ð¸:" 
                                   FontSize="13" 
                                   FontWeight="SemiBold" 
                                   Margin="0,0,0,8"/>
                        <ItemsControl ItemsSource="{Binding ElementName=CustomizationPageRoot, Path=ViewModel.SelectedChallenges}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border CornerRadius="8"
                                            Margin="4"
                                            Width="80"
                                            Height="80"
                                            ClipToBounds="True"
                                            Cursor="Hand"
                                            MouseLeftButtonDown="SelectedChallenge_MouseLeftButtonDown">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="Background" Value="{DynamicResource CardBackgroundFillColorDefaultBrush}"/>
                                                <Setter Property="BorderBrush" Value="#FF6366F1"/>
                                                <Setter Property="BorderThickness" Value="2"/>
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="BorderBrush" Value="#FFFF6B6B"/>
                                                        <Setter Property="BorderThickness" Value="3"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <Grid>
                                            <Image Source="{Binding Converter={StaticResource ChallengeIconConverter}, ConverterParameter=80}"
                                                   Stretch="UniformToFill"/>
                                            <Border Background="#80000000" 
                                                    VerticalAlignment="Top" 
                                                    HorizontalAlignment="Right"
                                                    CornerRadius="0,8,0,8"
                                                    Padding="4,2">
                                                <TextBlock Text="âœ•"
                                                           Foreground="White"
                                                           FontSize="12"
                                                           FontWeight="Bold"/>
                                            </Border>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                    
                    <ui:TextBox Text="{Binding ElementName=CustomizationPageRoot, Path=ViewModel.ChallengeSearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                PlaceholderText="ðŸ” ÐŸÐ¾Ð¸ÑÐº Ñ‡ÐµÐ»ÐµÐ½Ð´Ð¶Ð°..."
                                Margin="0,0,0,12"/>
                    
                    <ScrollViewer MaxHeight="400" VerticalScrollBarVisibility="Auto" Margin="0,0,0,12">
                        <ItemsControl ItemsSource="{Binding ElementName=CustomizationPageRoot, Path=ViewModel.FilteredChallenges}"
                                      ItemTemplate="{StaticResource ChallengeTemplate}"
                                      VirtualizingPanel.IsVirtualizing="True"
                                      VirtualizingPanel.VirtualizationMode="Recycling">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <VirtualizingStackPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                        </ItemsControl>
                    </ScrollViewer>
                    
                    <ui:Button Content="ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ"
                               Command="{Binding ElementName=CustomizationPageRoot, Path=ViewModel.SetChallengesCommand}"
                               IsEnabled="{Binding ElementName=CustomizationPageRoot, Path=ViewModel.IsLoading, Converter={StaticResource InverseBoolToVisibility}}"
                               Appearance="Primary"
                               MinWidth="100"
                               HorizontalAlignment="Left"/>
                </StackPanel>
            </ui:Card>
        </StackPanel>
    </ScrollViewer>
</UserControl>

