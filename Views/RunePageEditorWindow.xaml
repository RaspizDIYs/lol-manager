<ui:FluentWindow x:Class="LolManager.Views.RunePageEditorWindow"
                xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
                xmlns:converters="clr-namespace:LolManager.Converters"
                Title="Редактор страницы рун"
                Width="900"
                Height="650"
                WindowStartupLocation="CenterOwner"
                ResizeMode="NoResize"
                MinWidth="900"
                MinHeight="650"
                MaxWidth="900"
                MaxHeight="650"
                ExtendsContentIntoTitleBar="True"
                WindowBackdropType="Mica">
    
    <Window.Resources>
        <ResourceDictionary>
        <converters:NotNullConverter x:Key="NotNullConverter"/>
        <converters:MultiObjectEqualityConverter x:Key="MultiObjectEqualityConverter"/>
        <converters:RunePathColorConverter x:Key="RunePathColorConverter"/>
        <converters:RuneImageConverter x:Key="RuneImageConverter"/>
        <BooleanToVisibilityConverter x:Key="BoolToVisibility"/>
        
        <!-- Компактный стиль для обычных рун -->
        <Style x:Key="CompactRuneButton" TargetType="RadioButton">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Grid Width="36" Height="36">
                            <Border x:Name="BackgroundBorder"
                                   Background="Transparent"
                                   BorderBrush="Transparent"
                                   BorderThickness="2"
                                   Width="34" Height="34"
                                   CornerRadius="20"/>
                            
                            <Image Source="{Binding Icon, Converter={StaticResource RuneImageConverter}}"
                                  Width="28" Height="28"
                                  x:Name="RuneIcon"
                                  Opacity="0.6"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="RuneIcon" Property="Opacity" Value="0.85"/>
                                <Setter TargetName="BackgroundBorder" Property="Background" Value="{DynamicResource SubtleFillColorSecondaryBrush}"/>
                                <Setter TargetName="BackgroundBorder" Property="BorderBrush" Value="{DynamicResource AccentFillColorDefaultBrush}"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="RuneIcon" Property="Opacity" Value="1.0"/>
                                <Setter TargetName="BackgroundBorder" Property="BorderThickness" Value="3"/>
                                <Setter TargetName="BackgroundBorder" Property="BorderBrush" Value="{DynamicResource AccentFillColorDefaultBrush}"/>
                                <Setter TargetName="BackgroundBorder" Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect Color="#6C8CD5"
                                                         BlurRadius="12"
                                                         ShadowDepth="0"
                                                         Opacity="0.6"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="RuneIcon" Property="Opacity" Value="0.3"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Стиль для ключевых рун -->
        <Style x:Key="KeystoneRuneButton" TargetType="RadioButton" BasedOn="{StaticResource CompactRuneButton}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Grid Width="44" Height="44">
                            <Border x:Name="BackgroundBorder"
                                   Background="Transparent"
                                   BorderBrush="Transparent"
                                   BorderThickness="2"
                                   Width="42" Height="42"
                                   CornerRadius="24"/>
                            
                            <Image Source="{Binding Icon, Converter={StaticResource RuneImageConverter}}"
                                  Width="36" Height="36"
                                  x:Name="RuneIcon"
                                  Opacity="0.6"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="RuneIcon" Property="Opacity" Value="0.85"/>
                                <Setter TargetName="BackgroundBorder" Property="Background" Value="{DynamicResource SubtleFillColorSecondaryBrush}"/>
                                <Setter TargetName="BackgroundBorder" Property="BorderBrush" Value="{DynamicResource AccentFillColorDefaultBrush}"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="RuneIcon" Property="Opacity" Value="1.0"/>
                                <Setter TargetName="BackgroundBorder" Property="BorderThickness" Value="3"/>
                                <Setter TargetName="BackgroundBorder" Property="BorderBrush" Value="{DynamicResource AccentFillColorDefaultBrush}"/>
                                <Setter TargetName="BackgroundBorder" Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect Color="#6C8CD5"
                                                         BlurRadius="16"
                                                         ShadowDepth="0"
                                                         Opacity="0.8"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="RuneIcon" Property="Opacity" Value="0.3"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Стиль для иконок путей -->
        <Style x:Key="PathIconButton" TargetType="RadioButton">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Margin" Value="4"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Grid Width="48" Height="48">
                            <Border x:Name="BackgroundBorder"
                                   Background="Transparent"
                                   BorderBrush="Transparent"
                                   BorderThickness="2"
                                   Width="48"
                                   Height="48"
                                   CornerRadius="26"/>
                            
                            <Image Source="{Binding Icon, Converter={StaticResource RuneImageConverter}}"
                                  Width="40" Height="40"
                                  x:Name="PathIcon"
                                  Opacity="0.6"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="PathIcon" Property="Opacity" Value="0.85"/>
                                <Setter TargetName="BackgroundBorder" Property="Background" Value="{DynamicResource SubtleFillColorSecondaryBrush}"/>
                                <Setter TargetName="BackgroundBorder" Property="BorderBrush" Value="{Binding Converter={StaticResource RunePathColorConverter}}"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="PathIcon" Property="Opacity" Value="1.0"/>
                                <Setter TargetName="BackgroundBorder" Property="BorderThickness" Value="3"/>
                                <Setter TargetName="BackgroundBorder" Property="BorderBrush" Value="{Binding Converter={StaticResource RunePathColorConverter}}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Стиль для вторичных путей (меньше размером) -->
        <Style x:Key="SecondaryPathIconButton" TargetType="RadioButton" BasedOn="{StaticResource PathIconButton}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Grid Width="40" Height="40">
                            <Border x:Name="BackgroundBorder"
                                   Background="Transparent"
                                   BorderBrush="Transparent"
                                   BorderThickness="2"
                                   Width="38" Height="38"
                                   CornerRadius="22"/>
                            
                            <Image Source="{Binding Icon, Converter={StaticResource RuneImageConverter}}"
                                  Width="32" Height="32"
                                  x:Name="PathIcon"
                                  Opacity="0.6"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="PathIcon" Property="Opacity" Value="0.85"/>
                                <Setter TargetName="BackgroundBorder" Property="Background" Value="{DynamicResource SubtleFillColorSecondaryBrush}"/>
                                <Setter TargetName="BackgroundBorder" Property="BorderBrush" Value="{Binding Converter={StaticResource RunePathColorConverter}}"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="PathIcon" Property="Opacity" Value="1.0"/>
                                <Setter TargetName="BackgroundBorder" Property="BorderThickness" Value="3"/>
                                <Setter TargetName="BackgroundBorder" Property="BorderBrush" Value="{Binding Converter={StaticResource RunePathColorConverter}}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Стиль для статистических модификаторов -->
        <Style x:Key="StatModButton" TargetType="RadioButton" BasedOn="{StaticResource CompactRuneButton}">
            <Setter Property="Margin" Value="1"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Grid Width="36" Height="36">
                            <Border x:Name="BackgroundBorder"
                                   Background="Transparent"
                                   BorderBrush="Transparent"
                                   BorderThickness="2"
                                   Width="34" Height="34"
                                   CornerRadius="16"/>
                            
                            <Image Source="{Binding Icon, Converter={StaticResource RuneImageConverter}}"
                                  Width="24" Height="24"
                                  x:Name="StatIcon"
                                  Opacity="0.6"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="StatIcon" Property="Opacity" Value="0.85"/>
                                <Setter TargetName="BackgroundBorder" Property="Background" Value="{DynamicResource SubtleFillColorSecondaryBrush}"/>
                                <Setter TargetName="BackgroundBorder" Property="BorderBrush">
                                    <Setter.Value>
                                        <SolidColorBrush Color="#6C8CD5"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="StatIcon" Property="Opacity" Value="1.0"/>
                                <Setter TargetName="BackgroundBorder" Property="BorderThickness" Value="3"/>
                                <Setter TargetName="BackgroundBorder" Property="BorderBrush">
                                    <Setter.Value>
                                        <SolidColorBrush Color="#6C8CD5"/>
                                    </Setter.Value>
                                </Setter>
                                <Setter TargetName="BackgroundBorder" Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect Color="#6C8CD5"
                                                         BlurRadius="10"
                                                         ShadowDepth="0"
                                                         Opacity="0.7"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="StatIcon" Property="Opacity" Value="0.3"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        </ResourceDictionary>
    </Window.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- Title Bar -->
        <ui:TitleBar Grid.Row="0" Title="Редактор страницы рун" ShowMaximize="False"/>
        
        <!-- Main Content -->
        <Grid Grid.Row="1" Margin="12">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            
            
            <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <!-- ЛЕВЫЙ СТОЛБЕЦ: Основной путь и основные руны -->
            <StackPanel Grid.Column="0" Margin="0,0,6,0">
                <!-- Header with name input -->
                <ui:Card Padding="12" Margin="0,0,0,12">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <ui:TextBox Grid.Column="0"
                                   Text="{Binding PageName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                   PlaceholderText="Название страницы рун"
                                   FontSize="14"
                                   MaxLength="50"
                                   Margin="0,0,8,0"/>
                        
                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                            <ui:Button Content="Отмена"
                                      Click="CancelButton_Click"
                                      Appearance="Secondary"
                                      Margin="0,0,6,0"/>
                            <ui:Button Content="Сохранить"
                                      Click="SaveButton_Click"
                                      Appearance="Primary"/>
                        </StackPanel>
                    </Grid>
                </ui:Card>
                
                <!-- Primary Path and Runes -->
                <ui:Card Padding="16">
                    <StackPanel>
                        <TextBlock Text="ОСНОВНОЙ ПУТЬ И РУНЫ" 
                                   FontSize="14"
                                   FontWeight="SemiBold"
                                   Foreground="{DynamicResource AccentFillColorDefaultBrush}"
                                   HorizontalAlignment="Center"
                                   Margin="0,0,0,16"/>
                        
                        <!-- Primary Path Selection -->
                        <StackPanel Margin="0,0,0,16">
                            <TextBlock Text="ОСНОВНОЙ ПУТЬ" 
                                       FontSize="11"
                                       FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                       HorizontalAlignment="Center"
                                       Margin="0,0,0,8"/>
                            
                            <ItemsControl ItemsSource="{Binding AllPaths}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel HorizontalAlignment="Center"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <RadioButton GroupName="PrimaryPath"
                                                   Content="{Binding}"
                                                   Checked="PrimaryPath_Checked"
                                                   Style="{StaticResource PathIconButton}"
                                                   ToolTip="{Binding Name}">
                                            <RadioButton.IsChecked>
                                                <MultiBinding Converter="{StaticResource MultiObjectEqualityConverter}" Mode="OneWay">
                                                    <Binding Path="DataContext.SelectedPrimaryPath" RelativeSource="{RelativeSource AncestorType=Window}" Mode="OneWay"/>
                                                    <Binding Path="." Mode="OneWay"/>
                                                </MultiBinding>
                                            </RadioButton.IsChecked>
                                        </RadioButton>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                        
                        <!-- Primary Runes -->
                        <StackPanel>
                            <!-- Keystone -->
                            <StackPanel Margin="0,0,0,12">
                                <ItemsControl ItemsSource="{Binding KeystoneRunes}" 
                                             IsEnabled="{Binding SelectedPrimaryPath, Converter={StaticResource NotNullConverter}}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <WrapPanel HorizontalAlignment="Center"/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <RadioButton GroupName="Keystone"
                                                       Content="{Binding}"
                                                       Checked="KeystoneRune_Checked"
                                                       Style="{StaticResource KeystoneRuneButton}"
                                                       ToolTip="{Binding Name}">
                                                <RadioButton.IsChecked>
                                                    <MultiBinding Converter="{StaticResource MultiObjectEqualityConverter}" Mode="OneWay">
                                                        <Binding Path="DataContext.SelectedKeystone" RelativeSource="{RelativeSource AncestorType=Window}" Mode="OneWay"/>
                                                        <Binding Path="." Mode="OneWay"/>
                                                    </MultiBinding>
                                                </RadioButton.IsChecked>
                                            </RadioButton>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                            
                            <!-- Primary Slots -->
                            <StackPanel Margin="0,0,0,8">
                                <ItemsControl ItemsSource="{Binding PrimarySlot1Runes}" 
                                             IsEnabled="{Binding SelectedPrimaryPath, Converter={StaticResource NotNullConverter}}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <WrapPanel HorizontalAlignment="Center"/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <RadioButton GroupName="PrimarySlot1"
                                                       Content="{Binding}"
                                                       Checked="PrimarySlot1Rune_Checked"
                                                       Style="{StaticResource CompactRuneButton}"
                                                       ToolTip="{Binding Name}">
                                                <RadioButton.IsChecked>
                                                    <MultiBinding Converter="{StaticResource MultiObjectEqualityConverter}" Mode="OneWay">
                                                        <Binding Path="DataContext.SelectedPrimarySlot1" RelativeSource="{RelativeSource AncestorType=Window}" Mode="OneWay"/>
                                                        <Binding Path="." Mode="OneWay"/>
                                                    </MultiBinding>
                                                </RadioButton.IsChecked>
                                            </RadioButton>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                            
                            <StackPanel Margin="0,0,0,8">
                                <ItemsControl ItemsSource="{Binding PrimarySlot2Runes}" 
                                             IsEnabled="{Binding SelectedPrimaryPath, Converter={StaticResource NotNullConverter}}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <WrapPanel HorizontalAlignment="Center"/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <RadioButton GroupName="PrimarySlot2"
                                                       Content="{Binding}"
                                                       Checked="PrimarySlot2Rune_Checked"
                                                       Style="{StaticResource CompactRuneButton}"
                                                       ToolTip="{Binding Name}">
                                                <RadioButton.IsChecked>
                                                    <MultiBinding Converter="{StaticResource MultiObjectEqualityConverter}" Mode="OneWay">
                                                        <Binding Path="DataContext.SelectedPrimarySlot2" RelativeSource="{RelativeSource AncestorType=Window}" Mode="OneWay"/>
                                                        <Binding Path="." Mode="OneWay"/>
                                                    </MultiBinding>
                                                </RadioButton.IsChecked>
                                            </RadioButton>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                            
                            <StackPanel>
                                <ItemsControl ItemsSource="{Binding PrimarySlot3Runes}" 
                                             IsEnabled="{Binding SelectedPrimaryPath, Converter={StaticResource NotNullConverter}}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <WrapPanel HorizontalAlignment="Center"/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <RadioButton GroupName="PrimarySlot3"
                                                       Content="{Binding}"
                                                       Checked="PrimarySlot3Rune_Checked"
                                                       Style="{StaticResource CompactRuneButton}"
                                                       ToolTip="{Binding Name}">
                                                <RadioButton.IsChecked>
                                                    <MultiBinding Converter="{StaticResource MultiObjectEqualityConverter}" Mode="OneWay">
                                                        <Binding Path="DataContext.SelectedPrimarySlot3" RelativeSource="{RelativeSource AncestorType=Window}" Mode="OneWay"/>
                                                        <Binding Path="." Mode="OneWay"/>
                                                    </MultiBinding>
                                                </RadioButton.IsChecked>
                                            </RadioButton>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </ui:Card>
            </StackPanel>
            
            <!-- ПРАВЫЙ СТОЛБЕЦ: Дополнительный путь, дополнительные руны и статистика -->
            <StackPanel Grid.Column="1" Margin="6,0,0,0">
                <!-- Secondary Path, Runes and Stats -->
                <ui:Card Padding="16">
                    <StackPanel>
                        <TextBlock Text="ДОПОЛНИТЕЛЬНЫЕ РУНЫ И ОСКОЛКИ" 
                                   FontSize="14"
                                   FontWeight="SemiBold"
                                   Foreground="{DynamicResource AccentFillColorDefaultBrush}"
                                   HorizontalAlignment="Center"
                                   Margin="0,0,0,16"/>
                        
                        <!-- Secondary Path Selection -->
                        <StackPanel Margin="0,0,0,16">
                            <TextBlock Text="ДОПОЛНИТЕЛЬНЫЙ ПУТЬ" 
                                       FontSize="11"
                                       FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                       HorizontalAlignment="Center"
                                       Margin="0,0,0,8"/>
                            
                            <ItemsControl ItemsSource="{Binding AvailableSecondaryPaths}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel HorizontalAlignment="Center"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <RadioButton GroupName="SecondaryPath"
                                                   Content="{Binding}"
                                                   Checked="SecondaryPath_Checked"
                                                   Style="{StaticResource SecondaryPathIconButton}"
                                                   ToolTip="{Binding Name}">
                                            <RadioButton.IsChecked>
                                                <MultiBinding Converter="{StaticResource MultiObjectEqualityConverter}" Mode="OneWay">
                                                    <Binding Path="DataContext.SelectedSecondaryPath" RelativeSource="{RelativeSource AncestorType=Window}" Mode="OneWay"/>
                                                    <Binding Path="." Mode="OneWay"/>
                                                </MultiBinding>
                                            </RadioButton.IsChecked>
                                        </RadioButton>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                        
                        <!-- Secondary Runes -->
                        <StackPanel Margin="0,0,0,16">
                            <TextBlock Text="ДОПОЛНИТЕЛЬНЫЕ РУНЫ (2 из разных рядов)" 
                                       FontSize="11"
                                       FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                       HorizontalAlignment="Center"
                                       Margin="0,0,0,8"/>
                            
                            <StackPanel Margin="0,0,0,6">
                                <ItemsControl ItemsSource="{Binding SecondarySlot1Runes}" 
                                             IsEnabled="{Binding SelectedSecondaryPath, Converter={StaticResource NotNullConverter}}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <WrapPanel HorizontalAlignment="Center"/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <RadioButton GroupName="SecondarySlot1"
                                                           Content="{Binding}"
                                                           Checked="SecondarySlot1Rune_Checked"
                                                           Style="{StaticResource CompactRuneButton}"
                                                           ToolTip="{Binding Name}">
                                                <RadioButton.IsChecked>
                                                    <MultiBinding Converter="{StaticResource MultiObjectEqualityConverter}" Mode="OneWay">
                                                        <Binding Path="DataContext.SelectedSecondarySlot1" RelativeSource="{RelativeSource AncestorType=Window}" Mode="OneWay"/>
                                                        <Binding Path="." Mode="OneWay"/>
                                                    </MultiBinding>
                                                </RadioButton.IsChecked>
                                            </RadioButton>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                            
                            <StackPanel Margin="0,0,0,6">
                                <ItemsControl ItemsSource="{Binding SecondarySlot2Runes}" 
                                             IsEnabled="{Binding SelectedSecondaryPath, Converter={StaticResource NotNullConverter}}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <WrapPanel HorizontalAlignment="Center"/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <RadioButton GroupName="SecondarySlot2"
                                                           Content="{Binding}"
                                                           Checked="SecondarySlot2Rune_Checked"
                                                           Style="{StaticResource CompactRuneButton}"
                                                           ToolTip="{Binding Name}">
                                                <RadioButton.IsChecked>
                                                    <MultiBinding Converter="{StaticResource MultiObjectEqualityConverter}" Mode="OneWay">
                                                        <Binding Path="DataContext.SelectedSecondarySlot2" RelativeSource="{RelativeSource AncestorType=Window}" Mode="OneWay"/>
                                                        <Binding Path="." Mode="OneWay"/>
                                                    </MultiBinding>
                                                </RadioButton.IsChecked>
                                            </RadioButton>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                            
                            <StackPanel>
                                <ItemsControl ItemsSource="{Binding SecondarySlot3Runes}" 
                                             IsEnabled="{Binding SelectedSecondaryPath, Converter={StaticResource NotNullConverter}}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <WrapPanel HorizontalAlignment="Center"/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <RadioButton GroupName="SecondarySlot3"
                                                           Content="{Binding}"
                                                           Checked="SecondarySlot3Rune_Checked"
                                                           Style="{StaticResource CompactRuneButton}"
                                                           ToolTip="{Binding Name}">
                                                <RadioButton.IsChecked>
                                                    <MultiBinding Converter="{StaticResource MultiObjectEqualityConverter}" Mode="OneWay">
                                                        <Binding Path="DataContext.SelectedSecondarySlot3" RelativeSource="{RelativeSource AncestorType=Window}" Mode="OneWay"/>
                                                        <Binding Path="." Mode="OneWay"/>
                                                    </MultiBinding>
                                                </RadioButton.IsChecked>
                                            </RadioButton>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </StackPanel>
                        
                        <!-- Shards -->
                        <StackPanel>
                            <TextBlock Text="ОСКОЛКИ" 
                                       FontSize="11"
                                       FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                       HorizontalAlignment="Center"
                                       Margin="0,0,0,8"/>
                            
                            <StackPanel Margin="0,0,0,6">
                                <ItemsControl ItemsSource="{Binding StatModsRow1}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center"/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <RadioButton GroupName="StatMod1"
                                                       Content="{Binding}"
                                                       Checked="StatMod1_Checked"
                                                       Style="{StaticResource StatModButton}"
                                                       ToolTip="{Binding Name}">
                                                <RadioButton.IsChecked>
                                                    <MultiBinding Converter="{StaticResource MultiObjectEqualityConverter}" Mode="OneWay">
                                                        <Binding Path="DataContext.SelectedStatMod1" RelativeSource="{RelativeSource AncestorType=Window}" Mode="OneWay"/>
                                                        <Binding Path="." Mode="OneWay"/>
                                                    </MultiBinding>
                                                </RadioButton.IsChecked>
                                            </RadioButton>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                            
                            <StackPanel Margin="0,0,0,6">
                                <ItemsControl ItemsSource="{Binding StatModsRow2}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center"/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <RadioButton GroupName="StatMod2"
                                                       Content="{Binding}"
                                                       Checked="StatMod2_Checked"
                                                       Style="{StaticResource StatModButton}"
                                                       ToolTip="{Binding Name}">
                                                <RadioButton.IsChecked>
                                                    <MultiBinding Converter="{StaticResource MultiObjectEqualityConverter}" Mode="OneWay">
                                                        <Binding Path="DataContext.SelectedStatMod2" RelativeSource="{RelativeSource AncestorType=Window}" Mode="OneWay"/>
                                                        <Binding Path="." Mode="OneWay"/>
                                                    </MultiBinding>
                                                </RadioButton.IsChecked>
                                            </RadioButton>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                            
                            <StackPanel>
                                <ItemsControl ItemsSource="{Binding StatModsRow3}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center"/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <RadioButton GroupName="StatMod3"
                                                       Content="{Binding}"
                                                       Checked="StatMod3_Checked"
                                                       Style="{StaticResource StatModButton}"
                                                       ToolTip="{Binding Name}">
                                                <RadioButton.IsChecked>
                                                    <MultiBinding Converter="{StaticResource MultiObjectEqualityConverter}" Mode="OneWay">
                                                        <Binding Path="DataContext.SelectedStatMod3" RelativeSource="{RelativeSource AncestorType=Window}" Mode="OneWay"/>
                                                        <Binding Path="." Mode="OneWay"/>
                                                    </MultiBinding>
                                                </RadioButton.IsChecked>
                                            </RadioButton>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </ui:Card>
                
                <!-- Status -->
                <TextBlock x:Name="StatusText" 
                          Text="Заполните все поля для сохранения"
                          FontSize="12"
                          HorizontalAlignment="Center"
                          Margin="0,12,0,0"
                          Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
            </StackPanel>
            </Grid>
        </Grid>
    </Grid>
</ui:FluentWindow>
